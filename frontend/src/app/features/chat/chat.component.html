<div class="chat-container">
  <!-- Header -->
  <header class="bg-white border-b border-border-subtle px-6 py-4">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-xl font-display font-semibold text-text-primary">
          Chat Studio
        </h1>
        <p class="text-sm text-text-secondary">
          Ask questions in Turkish â€¢ Compare AI models
        </p>
      </div>

      <!-- Model Selector Tabs -->
      <div class="flex items-center gap-1 bg-slate-100 p-1 rounded-xl">
        @for (model of models; track model.key) {
          <button
            (click)="selectModel(model.key)"
            class="tab"
            [class.active]="api.currentModel() === model.key"
          >
            <span class="mr-1.5">{{ model.icon }}</span>
            {{ model.label }}
          </button>
        }
      </div>
    </div>
  </header>

  <!-- Messages Area -->
  <div #messagesContainer class="messages-area p-6 scrollbar-thin">
    <!-- Empty State -->
    @if (api.chatHistory().length === 0) {
      <div class="h-full flex flex-col items-center justify-center text-center px-4 page-enter">
        <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-primary-100 to-primary-50 
                    flex items-center justify-center mb-6 shadow-soft">
          <span class="text-4xl">ğŸ¤–</span>
        </div>
        <h2 class="text-2xl font-display font-semibold text-text-primary mb-2">
          RAG Chatbot'a HoÅŸ Geldiniz
        </h2>
        <p class="text-text-secondary max-w-md mb-8">
          TÃ¼rkÃ§e sorularÄ±nÄ±zÄ± sorun ve farklÄ± AI modellerinin yanÄ±tlarÄ±nÄ± karÅŸÄ±laÅŸtÄ±rÄ±n.
          Tarih, teknoloji ve bilim konularÄ±nda 50 adet soru-cevap Ã§ifti bulunmaktadÄ±r.
        </p>

        <!-- Sample Questions -->
        <div class="w-full max-w-xl">
          <p class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-3">
            Ã–rnek Sorular
          </p>
          <div class="grid grid-cols-2 gap-3">
            @for (question of sampleQuestions; track question) {
              <button
                (click)="useSampleQuestion(question)"
                class="card p-4 text-left hover:border-primary-300 transition-all group"
              >
                <span class="text-sm text-text-secondary group-hover:text-text-primary transition-colors">
                  {{ question }}
                </span>
              </button>
            }
          </div>
        </div>
      </div>
    }

    <!-- Chat Messages -->
    @if (api.chatHistory().length > 0) {
      <div class="space-y-6 max-w-4xl mx-auto">
        @for (message of api.chatHistory(); track message.id) {
          <div class="animate-slide-up" [class.flex-row-reverse]="message.role === 'user'">
            <!-- Message Bubble -->
            <div class="flex gap-3" [class.flex-row-reverse]="message.role === 'user'">
              <!-- Avatar -->
              <div class="flex-shrink-0">
                <div class="w-9 h-9 rounded-full flex items-center justify-center text-lg"
                     [class]="message.role === 'user' 
                              ? 'bg-primary-100' 
                              : 'bg-slate-100'">
                  {{ message.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–' }}
                </div>
              </div>

              <!-- Content -->
              <div class="flex-1 min-w-0" [class.text-right]="message.role === 'user'">
                <!-- Model Badge (for AI messages) -->
                @if (message.role === 'ai' && message.model) {
                  <div class="mb-1">
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full 
                                 text-xs font-medium bg-slate-100 text-text-secondary">
                      {{ message.model }}
                    </span>
                  </div>
                }

                <!-- Bubble -->
                <div class="inline-block chat-bubble"
                     [class.chat-bubble-user]="message.role === 'user'"
                     [class.chat-bubble-ai]="message.role === 'ai'">
                  <p class="whitespace-pre-wrap">{{ message.content }}</p>
                </div>

                <!-- Context Card (for AI messages) -->
                @if (message.role === 'ai' && message.context) {
                  <div class="mt-2 text-left">
                    <app-context-card
                      [context]="message.context"
                      [confidence]="message.confidence"
                      [responseTime]="message.responseTime"
                    />
                  </div>
                }

                <!-- Timestamp -->
                <p class="mt-1 text-xs text-text-muted">
                  {{ message.timestamp | date:'HH:mm' }}
                </p>
              </div>
            </div>
          </div>
        }

        <!-- Loading Indicator -->
        @if (api.isLoading()) {
          <div class="flex gap-3 animate-fade-in">
            <div class="w-9 h-9 rounded-full bg-slate-100 flex items-center justify-center">
              ğŸ¤–
            </div>
            <div class="chat-bubble chat-bubble-ai">
              <div class="typing-indicator py-1">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Error Message -->
  @if (api.error()) {
    <div class="mx-6 mb-4 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm animate-fade-in">
      <div class="flex items-center gap-2">
        <span>âš ï¸</span>
        <span>{{ api.error() }}</span>
        <button (click)="api.clearError()" class="ml-auto text-red-500 hover:text-red-700">
          âœ•
        </button>
      </div>
    </div>
  }

  <!-- Input Area -->
  <div class="input-area p-6 bg-gradient-to-t from-surface-main to-transparent">
    <div class="max-w-4xl mx-auto">
      <div class="card p-2 shadow-soft-lg flex items-end gap-2">
        <textarea
          #messageInput
          [(ngModel)]="userMessage"
          (keydown.enter)="$event.preventDefault(); sendMessage()"
          placeholder="Bir soru sorun..."
          rows="1"
          class="flex-1 px-4 py-3 bg-transparent border-0 resize-none 
                 text-text-primary placeholder-text-muted
                 focus:outline-none focus:ring-0"
          [disabled]="api.isLoading()"
        ></textarea>

        <div class="flex items-center gap-2 p-1">
          @if (api.chatHistory().length > 0) {
            <button
              (click)="clearChat()"
              class="btn-ghost p-2 rounded-lg"
              title="Clear chat"
            >
              ğŸ—‘ï¸
            </button>
          }

          <button
            (click)="sendMessage()"
            [disabled]="!userMessage.trim() || api.isLoading()"
            class="btn btn-primary"
            [class.opacity-50]="!userMessage.trim() || api.isLoading()"
          >
            @if (api.isLoading()) {
              <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
              </svg>
            } @else {
              <span>Send</span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M14 5l7 7m0 0l-7 7m7-7H3"/>
              </svg>
            }
          </button>
        </div>
      </div>

      <p class="text-center text-xs text-text-muted mt-3">
        Using <strong class="font-medium">{{ api.currentModel() }}</strong> model â€¢ 
        Press Enter to send
      </p>
    </div>
  </div>
</div>

